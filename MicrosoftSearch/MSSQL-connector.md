---
title: Соединитель Microsoft SQL Connector для Microsoft Search
ms.author: mounika.narayanan
author: monaray
manager: mnirkhe
ms.audience: Admin
ms.topic: article
ms.service: mssearch
localization_priority: Normal
search.appverid:
- BFB160
- MET150
- MOE150
description: Настройка соединителя Microsoft SQL Connector для поиска Майкрософт.
ms.openlocfilehash: a073a6d3f226e5f8b0ea297494a8889f1f50bab1
ms.sourcegitcommit: 21361af7c244ffd6ff8689fd0ff0daa359bf4129
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/14/2019
ms.locfileid: "38626759"
---
# <a name="microsoft-sql-server-connector"></a><span data-ttu-id="650a2-103">Соединитель Microsoft SQL Server</span><span class="sxs-lookup"><span data-stu-id="650a2-103">Microsoft SQL server connector</span></span>

<span data-ttu-id="650a2-104">С помощью соединителя Microsoft SQL Server организация может находить и индексировать данные из локальной базы данных SQL Server.</span><span class="sxs-lookup"><span data-stu-id="650a2-104">With a Microsoft SQL server connector, your organization can discover and index data from an on-premises SQL Server database.</span></span> <span data-ttu-id="650a2-105">Соединитель индексирует указанное содержимое в Microsoft Search.</span><span class="sxs-lookup"><span data-stu-id="650a2-105">The connector indexes specified content into Microsoft Search.</span></span> <span data-ttu-id="650a2-106">Чтобы регулярно обновлять индекс с использованием исходных данных, он поддерживает периодический полный и добавочный обход контента.</span><span class="sxs-lookup"><span data-stu-id="650a2-106">To keep the index up to date with source data, it supports periodic full and incremental crawls.</span></span> <span data-ttu-id="650a2-107">С помощью соединителя SQL Server можно также ограничить доступ к результатам поиска для определенных пользователей.</span><span class="sxs-lookup"><span data-stu-id="650a2-107">With the SQL Server connector, you can also restrict access to search results for certain users.</span></span>

<span data-ttu-id="650a2-108">Эта статья предназначена для администраторов Microsoft 365 или пользователей, которые настраивают, запускают и отслеживают соединитель Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="650a2-108">This article is for Microsoft 365 administrators or anyone who configures, runs, and monitors a Microsoft SQL server connector.</span></span> <span data-ttu-id="650a2-109">В этой статье объясняется, как настроить возможности соединителя и соединителя, ограничения и способы устранения неполадок.</span><span class="sxs-lookup"><span data-stu-id="650a2-109">It explains how to configure your connector and connector capabilities, limitations, and troubleshooting techniques.</span></span>

## <a name="install-a-data-gateway"></a><span data-ttu-id="650a2-110">Установка Data Gateway</span><span class="sxs-lookup"><span data-stu-id="650a2-110">Install a data gateway</span></span>
<span data-ttu-id="650a2-111">Чтобы получить доступ к данным третьих сторон, необходимо установить и настроить шлюз Microsoft Power BI Gateway.</span><span class="sxs-lookup"><span data-stu-id="650a2-111">In order to access your third-party data, you must install and configure a Microsoft Power BI gateway.</span></span> <span data-ttu-id="650a2-112">Чтобы узнать больше, ознакомьтесь со статьей [Установка и локальный шлюз](https://docs.microsoft.com/data-integration/gateway/service-gateway-install) .</span><span class="sxs-lookup"><span data-stu-id="650a2-112">See [Install and on-premises gateway](https://docs.microsoft.com/data-integration/gateway/service-gateway-install) to learn more.</span></span>  

## <a name="connect-to-a-data-source"></a><span data-ttu-id="650a2-113">Подключение к источнику данных</span><span class="sxs-lookup"><span data-stu-id="650a2-113">Connect to a data source</span></span>
<span data-ttu-id="650a2-114">Чтобы подключить соединитель Microsoft SQL Server к источнику данных, необходимо настроить сервер базы данных, для которого выполняется обход, и локальный шлюз.</span><span class="sxs-lookup"><span data-stu-id="650a2-114">To connect your Microsoft SQL server connector to a data source, you must configure the database server you want crawled and the on-premises gateway.</span></span> <span data-ttu-id="650a2-115">Затем можно подключиться к базе данных с помощью требуемого метода проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="650a2-115">You can then connect to the database with the required authentication method.</span></span>

> [!NOTE]
> <span data-ttu-id="650a2-116">База данных должна работать под управлением SQL Server версии 2008 или более поздней.</span><span class="sxs-lookup"><span data-stu-id="650a2-116">Your database must run SQL server version 2008 or later.</span></span>

<span data-ttu-id="650a2-117">Чтобы выполнить поиск по контенту базы данных, необходимо указать SQL запросы при настройке соединителя.</span><span class="sxs-lookup"><span data-stu-id="650a2-117">To search your database content, you must specify SQL queries when you configure the connector.</span></span> <span data-ttu-id="650a2-118">Этим запросам SQL необходимо присвоить имена всем столбцам базы данных, которые необходимо индексировать (то есть свойствам источника), включая все соединения SQL, которые необходимо выполнить, чтобы получить все столбцы.</span><span class="sxs-lookup"><span data-stu-id="650a2-118">These SQL queries need to name all the database columns that you want to index (i.e. source properties), including any SQL joins that need to be performed to get all the columns.</span></span> <span data-ttu-id="650a2-119">Чтобы ограничить доступ к результатам поиска, необходимо указать списки управления доступом (ACL) с запросами SQL при настройке соединителя Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="650a2-119">To restrict access to search results, you must specify Access Control Lists (ACLs) with SQL queries when you configure the Microsoft SQL server connector.</span></span>

## <a name="full-crawl-required"></a><span data-ttu-id="650a2-120">Полный обход (обязательный)</span><span class="sxs-lookup"><span data-stu-id="650a2-120">Full crawl (Required)</span></span>
<span data-ttu-id="650a2-121">На этом этапе настраивается SQL-запрос, выполняющий полный обход базы данных.</span><span class="sxs-lookup"><span data-stu-id="650a2-121">In this step, you configure the SQL query that runs a full crawl of the database.</span></span> <span data-ttu-id="650a2-122">Полный обход контента выбирает все столбцы или свойства, которые необходимо сделать доступными для **запроса**, **поиска**или **извлечения**.</span><span class="sxs-lookup"><span data-stu-id="650a2-122">The full crawl selects all the columns or properties you want to be made **queryable**, **searchable**, or **retrievable**.</span></span> <span data-ttu-id="650a2-123">Кроме того, можно указать столбцы ACL, чтобы ограничить доступ к результатам поиска для определенных пользователей или групп.</span><span class="sxs-lookup"><span data-stu-id="650a2-123">You can also specify ACL columns to restrict access of search results to specific users or groups.</span></span>

> [!Tip]
> <span data-ttu-id="650a2-124">Чтобы получить все необходимые столбцы, можно присоединиться к нескольким таблицам.</span><span class="sxs-lookup"><span data-stu-id="650a2-124">To get all the columns that you need, you can join multiple tables.</span></span>

![Скрипт, в котором показаны свойства Ордертабле и Аклтабле с примерами](media/MSSQL-fullcrawl.png)

### <a name="select-data-columns-required-and-acl-columns-optional"></a><span data-ttu-id="650a2-126">Выбор столбцов данных (обязательных) и столбцов ACL (необязательно)</span><span class="sxs-lookup"><span data-stu-id="650a2-126">Select data columns (Required) and ACL columns (Optional)</span></span>
<span data-ttu-id="650a2-127">В этом примере показано, как выбрать пять столбцов данных, в которых хранятся данные для поиска: OrderId, Ордертитле, Ордердеск, CreatedDateTime и с удалением.</span><span class="sxs-lookup"><span data-stu-id="650a2-127">The example demonstrates selection of five data columns that hold the data for the search: OrderId, OrderTitle, OrderDesc, CreatedDateTime, and IsDeleted.</span></span> <span data-ttu-id="650a2-128">Чтобы задать разрешения на просмотр для каждой строки данных, можно дополнительно выбрать следующие столбцы ACL: Алловедусерс, Алловедграупс, Дениедусерс и Дениедграупс.</span><span class="sxs-lookup"><span data-stu-id="650a2-128">To set view permissions for each row of data, you can optionally select these ACL columns: AllowedUsers, AllowedGroups, DeniedUsers, and DeniedGroups.</span></span> <span data-ttu-id="650a2-129">Все эти столбцы данных можно сделать доступными для **запроса**, **поиска**или **извлечения**.</span><span class="sxs-lookup"><span data-stu-id="650a2-129">All these data columns can be made **queryable**, **searchable**, or **retrievable**.</span></span>

<span data-ttu-id="650a2-130">Выберите столбцы данных, как показано в следующем примере запроса:`SELECT OrderId, OrderTitle, OrderDesc, AllowedUsers, AllowedGroups, DeniedUsers, DeniedGroups, CreatedDateTime, IsDeleted`</span><span class="sxs-lookup"><span data-stu-id="650a2-130">Select data columns as shown in this example query: `SELECT OrderId, OrderTitle, OrderDesc, AllowedUsers, AllowedGroups, DeniedUsers, DeniedGroups, CreatedDateTime, IsDeleted`</span></span>

### <a name="watermark-required"></a><span data-ttu-id="650a2-131">Водяной знак (обязательный)</span><span class="sxs-lookup"><span data-stu-id="650a2-131">Watermark (Required)</span></span>
<span data-ttu-id="650a2-132">Чтобы избежать перегрузки базы данных, пакеты соединителя и возобновляют запросы на полный обход контента с помощью столбца водяного знака для полного обхода.</span><span class="sxs-lookup"><span data-stu-id="650a2-132">To prevent overloading the database, the connector batches and resumes full-crawl queries with a full-crawl watermark column.</span></span> <span data-ttu-id="650a2-133">С помощью значения столбца водяного знака, каждый последующий пакет извлекается, а запрос возобновляется из последней контрольной точки.</span><span class="sxs-lookup"><span data-stu-id="650a2-133">By using the value of the watermark column, each subsequent batch is fetched, and querying is resumed from the last checkpoint.</span></span> <span data-ttu-id="650a2-134">По сути, это механизм для управления обновлением данных при полном обходе.</span><span class="sxs-lookup"><span data-stu-id="650a2-134">Essentially this is a mechanism to control data refresh for full crawls.</span></span>

<span data-ttu-id="650a2-135">Создайте фрагменты запросов для водяных знаков, как показано в следующих примерах:</span><span class="sxs-lookup"><span data-stu-id="650a2-135">Create query snippets for watermarks as shown in these examples:</span></span>
* <span data-ttu-id="650a2-136">`WHERE (CreatedDateTime > @watermark)`.</span><span class="sxs-lookup"><span data-stu-id="650a2-136"></span></span> <span data-ttu-id="650a2-137">Заменяйте имя столбца водяного знака на `@watermark`зарезервированное ключевое слово.</span><span class="sxs-lookup"><span data-stu-id="650a2-137">Cite the watermark column name with the reserved keyword `@watermark`.</span></span> <span data-ttu-id="650a2-138">Если порядок сортировки столбца водяного знака — по возрастанию, используйте `>`; в противном `<`случае используйте.</span><span class="sxs-lookup"><span data-stu-id="650a2-138">If the sort order of the watermark column is ascending, use `>`; otherwise, use `<`.</span></span>
* <span data-ttu-id="650a2-139">`ORDER BY CreatedDateTime ASC`.</span><span class="sxs-lookup"><span data-stu-id="650a2-139"></span></span> <span data-ttu-id="650a2-140">Сортировать по столбцу водяных знаков в возрастающем или убывающем порядке.</span><span class="sxs-lookup"><span data-stu-id="650a2-140">Sort on the watermark column in ascending or descending order.</span></span>

<span data-ttu-id="650a2-141">В конфигурации, показанной на следующем изображении `CreatedDateTime` , является выбранным столбцом водяных знаков.</span><span class="sxs-lookup"><span data-stu-id="650a2-141">In the configuration shown in the following image, `CreatedDateTime` is the selected watermark column.</span></span> <span data-ttu-id="650a2-142">Чтобы получить первый пакет строк, укажите тип данных столбца "водяной знак".</span><span class="sxs-lookup"><span data-stu-id="650a2-142">To fetch the first batch of rows, specify the data type of the watermark column.</span></span> <span data-ttu-id="650a2-143">В этом случае типом данных является `DateTime`.</span><span class="sxs-lookup"><span data-stu-id="650a2-143">In this case, the data type is `DateTime`.</span></span>

![](media/MSSQL-watermark.png)

<span data-ttu-id="650a2-144">Первый запрос извлекает первые **N** строк, используя: "CreatedDateTime > 1 января 1753 00:00:00" (минимальное значение типа данных DateTime).</span><span class="sxs-lookup"><span data-stu-id="650a2-144">The first query fetches the first **N** amount of rows by using: "CreatedDateTime > January 1, 1753 00:00:00" (min value of DateTime data type).</span></span> <span data-ttu-id="650a2-145">После извлечения первого пакета наибольшее значение, `CreatedDateTime` возвращенное в пакете, сохраняется в виде контрольной точки, если строки сортируются в возрастающем порядке.</span><span class="sxs-lookup"><span data-stu-id="650a2-145">After the first batch is fetched, the highest value of `CreatedDateTime` returned in the batch is saved as the checkpoint if the rows are sorted in ascending order.</span></span> <span data-ttu-id="650a2-146">Пример: 1 марта 2019 03:00:00.</span><span class="sxs-lookup"><span data-stu-id="650a2-146">An example is March 1, 2019 03:00:00.</span></span> <span data-ttu-id="650a2-147">Затем следующий пакет из **N** строк извлекается с помощью "CreatedDateTime > 1 марта 2019 03:00:00" в запросе.</span><span class="sxs-lookup"><span data-stu-id="650a2-147">Then the next batch of **N** rows is fetched by using "CreatedDateTime > March 1, 2019 03:00:00" in the query.</span></span>

### <a name="skipping-soft-deleted-rows-optional"></a><span data-ttu-id="650a2-148">Пропуск обратимо удаленных строк (необязательно)</span><span class="sxs-lookup"><span data-stu-id="650a2-148">Skipping soft-deleted rows (Optional)</span></span>
<span data-ttu-id="650a2-149">Чтобы исключить возможность индексирования обратимо удаленных строк в базе данных, укажите имя столбца с обратимым удалением и значение, указывающее на то, что строка удалена.</span><span class="sxs-lookup"><span data-stu-id="650a2-149">To exclude soft-deleted rows in your database from being indexed, specify the soft-delete column name and value that indicates the row is deleted.</span></span>

![Параметры обратимого удаления: "обратимое удаление столбца" и "значение столбца" обратимое удаление ", которое указывает на удаленную строку"](media/MSSQL-softdelete.png)

## <a name="incremental-crawl-optional"></a><span data-ttu-id="650a2-151">Добавочный обход (необязательно)</span><span class="sxs-lookup"><span data-stu-id="650a2-151">Incremental crawl (Optional)</span></span>
<span data-ttu-id="650a2-152">На этом необязательном этапе необходимо предоставить SQL-запрос для выполнения добавочного обхода базы данных.</span><span class="sxs-lookup"><span data-stu-id="650a2-152">In this optional step, provide a SQL query to run an incremental crawl of the database.</span></span> <span data-ttu-id="650a2-153">С помощью этого запроса соединитель Microsoft SQL Server вносит изменения в данные с момента последнего добавочного обхода.</span><span class="sxs-lookup"><span data-stu-id="650a2-153">With this query, the Microsoft SQL server connector makes any changes to the data since the last incremental crawl.</span></span> <span data-ttu-id="650a2-154">Как и при полном обходе контента, выберите все столбцы, которые необходимо сделать доступными для **запроса**, **поиска**или **извлечения**.</span><span class="sxs-lookup"><span data-stu-id="650a2-154">As in the full crawl, select all columns that you want to be made **queryable**, **searchable**, or **retrievable**.</span></span> <span data-ttu-id="650a2-155">Укажите тот же набор столбцов ACL, который вы указали в запросе на полный обход контента.</span><span class="sxs-lookup"><span data-stu-id="650a2-155">Specify the same set of ACL columns that you specified in the full crawl query.</span></span>

<span data-ttu-id="650a2-156">Компоненты на следующем изображении похожи на компоненты полного обхода с одним исключением.</span><span class="sxs-lookup"><span data-stu-id="650a2-156">The components in the following image resemble the full crawl components with one exception.</span></span> <span data-ttu-id="650a2-157">В этом случае "Модифиеддатетиме" является выбранным столбцом водяного знака.</span><span class="sxs-lookup"><span data-stu-id="650a2-157">In this case, "ModifiedDateTime" is the selected watermark column.</span></span> <span data-ttu-id="650a2-158">Ознакомьтесь с [полными шагами обхода](#full-crawl-required) , чтобы узнать, как создать запрос добавочного обхода контента и просмотреть приведенный ниже рисунок в качестве примера.</span><span class="sxs-lookup"><span data-stu-id="650a2-158">Review the [full crawl steps](#full-crawl-required) to learn how to write your incremental crawl query and see the following image as an example.</span></span>

![Скрипт добавочного обхода, в котором показаны Ордертабле, Аклтабле и примеры свойств, которые можно использовать.](media/MSSQL-incrcrawl.png)

## <a name="limitations"></a><span data-ttu-id="650a2-160">Ограничения</span><span class="sxs-lookup"><span data-stu-id="650a2-160">Limitations</span></span>
<span data-ttu-id="650a2-161">В предварительной версии Microsoft SQL Server Connector имеются следующие ограничения:</span><span class="sxs-lookup"><span data-stu-id="650a2-161">The Microsoft SQL server connector has these limitations in the preview release:</span></span>
* <span data-ttu-id="650a2-162">Локальная база данных должна работать под управлением SQL Server версии 2008 или более поздней.</span><span class="sxs-lookup"><span data-stu-id="650a2-162">The on-premises database must run SQL server version 2008 or later.</span></span>
* <span data-ttu-id="650a2-163">Списки управления доступом поддерживаются только с помощью имени участника-пользователя (UPN), Azure Active Directory (Azure AD) или безопасности Active Directory.</span><span class="sxs-lookup"><span data-stu-id="650a2-163">ACLs are only supported by using a User Principal Name (UPN), Azure Active Directory (Azure AD), or Active Directory Security.</span></span>
* <span data-ttu-id="650a2-164">Индексирование расширенного содержимого в столбцах базы данных не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="650a2-164">Indexing rich content inside database columns is not supported.</span></span> <span data-ttu-id="650a2-165">Примерами такого содержимого являются HTML, JSON, XML, BLOB-объекты и разбор документов, которые существуют в качестве ссылок в столбцах базы данных.</span><span class="sxs-lookup"><span data-stu-id="650a2-165">Examples of such content are HTML, JSON, XML, blobs, and document parsings that exist as links inside the database columns.</span></span>

