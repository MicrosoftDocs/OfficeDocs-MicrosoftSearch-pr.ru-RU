---
title: Соединитель Microsoft SQL Connector для Microsoft Search
ms.author: mounika.narayanan
author: monaray
manager: mnirkhe
ms.audience: Admin
ms.topic: article
ms.service: mssearch
localization_priority: Normal
search.appverid:
- BFB160
- MET150
- MOE150
description: Настройка соединителя Microsoft SQL Connector для поиска Майкрософт.
ms.openlocfilehash: c31399e65bd4bfc154d10d2e6057fa23d11f030d
ms.sourcegitcommit: ef1eb2bdf31dccd34f0fdc4aa7a0841ebd44f211
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/02/2019
ms.locfileid: "39663170"
---
# <a name="microsoft-sql-server-connector"></a>Соединитель Microsoft SQL Server

С помощью соединителя Microsoft SQL Server организация может находить и индексировать данные из локальной базы данных SQL Server. Соединитель индексирует указанное содержимое в Microsoft Search. Чтобы регулярно обновлять индекс с использованием исходных данных, он поддерживает периодический полный и добавочный обход контента. С помощью соединителя SQL Server можно также ограничить доступ к результатам поиска для определенных пользователей.

Эта статья предназначена для администраторов Microsoft 365 или пользователей, которые настраивают, запускают и отслеживают соединитель Microsoft SQL Server. В этой статье объясняется, как настроить возможности соединителя и соединителя, ограничения и способы устранения неполадок.

## <a name="install-a-data-gateway"></a>Установка Data Gateway
Чтобы получить доступ к данным третьих сторон, необходимо установить и настроить шлюз Microsoft Power BI Gateway. Чтобы узнать больше, ознакомьтесь со статьей [Установка и локальный шлюз](https://docs.microsoft.com/data-integration/gateway/service-gateway-install) .  

## <a name="connect-to-a-data-source"></a>Подключение к источнику данных
Чтобы подключить соединитель Microsoft SQL Server к источнику данных, необходимо настроить сервер базы данных, для которого выполняется обход, и локальный шлюз. Затем можно подключиться к базе данных с помощью требуемого метода проверки подлинности.

> [!NOTE]
> База данных должна работать под управлением SQL Server версии 2008 или более поздней.

Чтобы выполнить поиск по контенту базы данных, необходимо указать SQL запросы при настройке соединителя. Этим запросам SQL необходимо присвоить имена всем столбцам базы данных, которые необходимо индексировать (то есть свойствам источника), включая все соединения SQL, которые необходимо выполнить, чтобы получить все столбцы. Чтобы ограничить доступ к результатам поиска, необходимо указать списки управления доступом (ACL) с запросами SQL при настройке соединителя Microsoft SQL Server.

## <a name="full-crawl-required"></a>Полный обход (обязательный)
На этом этапе настраивается SQL-запрос, выполняющий полный обход базы данных. Полный обход контента выбирает все столбцы или свойства, которые необходимо сделать доступными для **запроса**, **поиска**или **извлечения**. Кроме того, можно указать столбцы ACL, чтобы ограничить доступ к результатам поиска для определенных пользователей или групп.

> [!Tip]
> Чтобы получить все необходимые столбцы, можно присоединиться к нескольким таблицам.

![Скрипт, в котором показаны свойства Ордертабле и Аклтабле с примерами](media/MSSQL-fullcrawl.png)

### <a name="select-data-columns-required-and-acl-columns-optional"></a>Выбор столбцов данных (обязательных) и столбцов ACL (необязательно)
В этом примере показано, как выбрать пять столбцов данных, в которых хранятся данные для поиска: OrderId, Ордертитле, Ордердеск, CreatedDateTime и с удалением. Чтобы задать разрешения на просмотр для каждой строки данных, можно дополнительно выбрать следующие столбцы ACL: Алловедусерс, Алловедграупс, Дениедусерс и Дениедграупс. Все эти столбцы данных можно сделать доступными для **запроса**, **поиска**или **извлечения**.

Выберите столбцы данных, как показано в следующем примере запроса:`SELECT OrderId, OrderTitle, OrderDesc, AllowedUsers, AllowedGroups, DeniedUsers, DeniedGroups, CreatedDateTime, IsDeleted`
 
Для управления доступом к результатам поиска можно указать один или несколько столбцов списка управления доступом в запросе. Соединитель SQL позволяет управлять доступом на уровне записей. Можно выбрать один и тот же элемент управления доступом для всех записей в таблице. Если сведения ACL хранятся в отдельной таблице, может потребоваться выполнить присоединение к этим таблицам в запросе.

Использование каждого из столбцов ACL в приведенном выше запросе описано ниже. В следующем списке описываются **механизмы управления доступом**4. 
* **Алловедусерс**: этот параметр задает список идентификаторов пользователей, которые будут иметь доступ к результатам поиска. В следующем примере список пользователей: john@contoso.com, keith@contoso.com и lisa@contoso.com будет иметь доступ только к записи с OrderId = 12. 
* **Алловедграупс**: этот параметр указывает группу пользователей, которые будут иметь доступ к результатам поиска. В следующем примере группа sales-team@contoso.com будет иметь доступ только к записи с OrderId = 12.
* **Дениедусерс**: этот параметр указывает список пользователей, у которых **нет доступа** к результатам поиска. В следующем примере пользователи john@contoso.com и keith@contoso.com не имеют доступа к записи с OrderId = 13, а все остальные пользователи имеют доступ к этой записи. 
* **Дениедграупс**: этот параметр указывает группу пользователей, у которых **нет доступа** к результатам поиска. В следующем примере группы engg-team@contoso.com и pm-team@contoso.com не имеют доступа к записи с OrderId = 15, тогда как все остальные пользователи имеют доступ к этой записи.  

![](media/MSSQL-ACL1.png)

### <a name="watermark-required"></a>Водяной знак (обязательный)
Чтобы избежать перегрузки базы данных, пакеты соединителя и возобновляют запросы на полный обход контента с помощью столбца водяного знака для полного обхода. С помощью значения столбца водяного знака, каждый последующий пакет извлекается, а запрос возобновляется из последней контрольной точки. По сути, это механизм для управления обновлением данных при полном обходе.

Создайте фрагменты запросов для водяных знаков, как показано в следующих примерах:
* `WHERE (CreatedDateTime > @watermark)`. Заменяйте имя столбца водяного знака на `@watermark`зарезервированное ключевое слово. Если порядок сортировки столбца водяного знака — по возрастанию, используйте `>`; в противном `<`случае используйте.
* `ORDER BY CreatedDateTime ASC`. Сортировать по столбцу водяных знаков в возрастающем или убывающем порядке.

В конфигурации, показанной на следующем изображении `CreatedDateTime` , является выбранным столбцом водяных знаков. Чтобы получить первый пакет строк, укажите тип данных столбца "водяной знак". В этом случае типом данных является `DateTime`.

![](media/MSSQL-watermark.png)

Первый запрос извлекает первые **N** строк, используя: "CreatedDateTime > 1 января 1753 00:00:00" (минимальное значение типа данных DateTime). После извлечения первого пакета наибольшее значение, `CreatedDateTime` возвращенное в пакете, сохраняется в виде контрольной точки, если строки сортируются в возрастающем порядке. Пример: 1 марта 2019 03:00:00. Затем следующий пакет из **N** строк извлекается с помощью "CreatedDateTime > 1 марта 2019 03:00:00" в запросе.

### <a name="skipping-soft-deleted-rows-optional"></a>Пропуск обратимо удаленных строк (необязательно)
Чтобы исключить возможность индексирования обратимо удаленных строк в базе данных, укажите имя столбца с обратимым удалением и значение, указывающее на то, что строка удалена.

![Параметры обратимого удаления: "обратимое удаление столбца" и "значение столбца" обратимое удаление ", которое указывает на удаленную строку"](media/MSSQL-softdelete.png)

### <a name="full-crawl-manage-search-permissions"></a>Полный обход контента: Управление разрешениями поиска
Щелкните **Управление разрешениями** , чтобы выбрать различные столбцы управления доступом (ACL), определяющие механизм управления доступом. Выберите имя столбца, указанного в SQL-запросе на полный обход контента. 

Предполагается, что каждый из столбцов ACL является столбцом с несколькими значениями. Эти несколько значений ID можно отделить разделителями, например точкой с запятой (;), запятая (,) и т. д. Этот разделитель необходимо указать в поле " **разделитель значений** ".
 
Для использования в качестве списков управления доступом (ACL) поддерживаются следующие типы ИДЕНТИФИКАТОРов: 
* **Имя участника-пользователя (UPN)**: имя участника-пользователя — это имя пользователя системы в формате электронного адреса. Имя участника-пользователя (например: john.doe@domain.com) состоит из имени пользователя (имени для входа), разделителя (символа @) и имени домена (суффикса имени участника-пользователя). 
* **Идентификатор Azure Active Directory (AAD)**: в AAD каждый пользователь или группа имеет идентификатор объекта, который выглядит примерно так: "e0d3ad3d-0000-1111-2222-3c5f5c52ab9b" 
* **Идентификатор безопасности Active Directory (AD)**: в локальной программе установки Active Directory все пользователи и группы имеют неизменяемый уникальный идентификатор безопасности, который выглядит примерно так: 1-5-21-3878594291-2115959936-132693609-65242.

![](media/MSSQL-ACL2.png)

## <a name="incremental-crawl-optional"></a>Добавочный обход (необязательно)
На этом необязательном этапе необходимо предоставить SQL-запрос для выполнения добавочного обхода базы данных. С помощью этого запроса соединитель Microsoft SQL Server вносит изменения в данные с момента последнего добавочного обхода. Как и при полном обходе контента, выберите все столбцы, которые необходимо сделать доступными для **запроса**, **поиска**или **извлечения**. Укажите тот же набор столбцов ACL, который вы указали в запросе на полный обход контента.

Компоненты на следующем изображении похожи на компоненты полного обхода с одним исключением. В этом случае "Модифиеддатетиме" является выбранным столбцом водяного знака. Ознакомьтесь с [полными шагами обхода](#full-crawl-required) , чтобы узнать, как создать запрос добавочного обхода контента и просмотреть приведенный ниже рисунок в качестве примера.

![Скрипт добавочного обхода, в котором показаны Ордертабле, Аклтабле и примеры свойств, которые можно использовать.](media/MSSQL-incrcrawl.png)

## <a name="manage-search-permissions"></a>Управление разрешениями поиска 
Вы можете использовать [списки управления доступом (ACL), указанные на экране "полный обход контента](#full-crawl-manage-search-permissions) ", или переопределить их, чтобы сделать контент видимым для всех.

## <a name="limitations"></a>Ограничения
В предварительной версии Microsoft SQL Server Connector имеются следующие ограничения:
* Локальная база данных должна работать под управлением SQL Server версии 2008 или более поздней.
* Списки управления доступом поддерживаются только с помощью имени участника-пользователя (UPN), Azure Active Directory (Azure AD) или безопасности Active Directory. 
* Индексирование расширенного содержимого в столбцах базы данных не поддерживается. Примерами такого содержимого являются HTML, JSON, XML, BLOB-объекты и разбор документов, которые существуют в качестве ссылок в столбцах базы данных.