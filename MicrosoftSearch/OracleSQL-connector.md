---
title: Соединит SQL Graph Oracle для Поиска (Майкрософт)
ms.author: mecampos
author: mecampos
manager: umas
ms.audience: Admin
ms.topic: article
ms.service: mssearch
localization_priority: Normal
search.appverid:
- BFB160
- MET150
- MOE150
ROBOTS: NoIndex
description: Настройка соединители Oracle SQL Graph для Поиска (Майкрософт).
ms.openlocfilehash: 01e4cd6b04d2997ea11ef006e94ea09b03280f41
ms.sourcegitcommit: 6a7f36769e92b714588b47efb0c185eddabe6953
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/04/2021
ms.locfileid: "50099338"
---
<!---Previous ms.author:vivg --->

# <a name="oracle-sql-graph-connector"></a>Соедините SQL Graph Oracle

Соединители Oracle SQL Graph позволяют организации обнаруживировать и индексировать данные из локальной базы данных Oracle. Соединители индексирует указанное содержимое в Поиск (Майкрософт). Чтобы поддерживать индекс в соответствии с исходными данными, он поддерживает периодические полные и добавонные обходы контента. С помощью SQL Oracle вы также можете ограничить доступ к результатам поиска для определенных пользователей.

> [!NOTE]
> Прочитайте [**статью "Настройка соединители Graph",**](configure-connector.md) чтобы ознакомиться с общим процессом настройки соединители Graph.

Эта статья для всех, кто настраивает, запускает и отслеживает соединители Oracle SQL Graph. Он дополняет общий процесс настройки и показывает инструкции, применимые только к соединитеструктору Oracle SQL Graph. В этой статье также содержатся сведения об [устранении неполадок](#troubleshooting) [и ограничениях.](#limitations)

## <a name="before-you-get-started"></a>Перед началом работы

### <a name="install-the-graph-connector-agent"></a>Установка агента соединителя Graph

Чтобы получить доступ к данным локальной сторонней компании, необходимо установить и настроить агент соединителя Graph. Дополнительные данные см. в подключении к агенту [соединителя Graph.](on-prem-agent.md)  

## <a name="step-1-add-a-graph-connector-in-the-microsoft-365-admin-center"></a>Шаг 1. Добавление соединителю Graph в Центре администрирования Microsoft 365

Следуйте общим [инструкциям по настройке.](https://docs.microsoft.com/microsoftsearch/configure-connector)
<!---If the above phrase does not apply, delete it and insert specific details for your data source that are different from general setup instructions.-->

## <a name="step-2-name-the-connection"></a>Шаг 2. Имя подключения

Следуйте общим [инструкциям по настройке.](https://docs.microsoft.com/microsoftsearch/configure-connector)
<!---If the above phrase does not apply, delete it and insert specific details for your data source that are different from general setup instructions.-->

## <a name="step-3-configure-the-connection-settings"></a>Шаг 3. Настройка параметров подключения

Чтобы подключить соединители Oracle SQL Oracle к источнику данных, необходимо настроить сервер базы данных для обхода и агент локального соединитела Graph. Затем можно подключиться к базе данных с помощью требуемого метода проверки подлинности.

Для соединителя Oracle SQL необходимо указать имя хоста, порта и службы (базы данных) вместе с предпочтительным методом проверки подлинности, именем пользователя и паролем.

> [!NOTE]
> Для подключения соединители в базе данных должна быть создана база данных Oracle версии 11g или более поздней. Соединитер поддерживает базу данных Oracle, которая работает на платформах windows, Linux и azure VM.

Для поиска контента базы данных необходимо указать SQL при настройке соединители. Эти SQL должны называть все столбцы базы данных, которые требуется индексировать (то есть свойства источника), включая все SQL, которые необходимо выполнить для получения всех столбцов. Чтобы ограничить доступ к результатам поиска, необходимо указать списки управления доступом (ALS) в SQL запросов при настройке соединителя.

## <a name="step-3a-full-crawl-required"></a>Шаг 3a. Полный обход контента (обязательно)

На этом этапе настраивается запрос SQL, который выполняет полный обход базы данных. При полном обходе выбираются все столбцы или свойства, для которых нужно выбрать **параметры**"Запрос", "Поиск" или **"Получить".** Можно также указать столбцы ACL, чтобы ограничить доступ к результатам поиска определенным пользователям или группам.

> [!Tip]
> Чтобы получить все необходимые столбцы, можно присоединить несколько таблиц.

![Сценарий, показывающий OrderTable и AclTable с примерами свойств](media/MSSQL-fullcrawl.png)

### <a name="select-data-columns-required-and-acl-columns-optional"></a>Выбор столбцов данных (обязательно) и столбцов ACL (необязательно)

В примере показано, как выбрать пять столбцов данных, в которые будут вметься данные для поиска: OrderId, OrderTitle, OrderDesc, CreatedDateTime и IsDeleted. Чтобы настроить разрешения на просмотр для каждой строки данных, можно при желании выбрать такие столбцы ACL: AllowedUsers, AllowedGroups, DeniedUsers и DeniedGroups. Для всех этих столбцов данных можно выбрать параметры "Запрос", **"Поиск"** или **"Получить".**

Выберите столбцы данных, как показано в этом примере запроса: `SELECT OrderId, OrderTitle, OrderDesc, AllowedUsers, AllowedGroups, DeniedUsers, DeniedGroups, CreatedDateTime, IsDeleted`

Для управления доступом к результатам поиска можно указать один или несколько столбцов ACL в запросе. Соединитель SQL позволяет управлять доступом на уровне записи. Вы можете выбрать один и тот же контроль доступа для всех записей в таблице. Если данные ACL хранятся в отдельной таблице, может потребоваться объединить эти таблицы в запросе.

Ниже описано использование каждого из столбцов ACL в приведенного выше запросе. В следующем списке поясняются четыре механизма **контроля доступа.**

* **AllowedUsers**: этот параметр указывает список ИД пользователей, которые будут иметь доступ к результатам поиска. В следующем примере список пользователей: john@contoso.com, keith@contoso.com и lisa@contoso.com будут иметь доступ только к записи с OrderId = 12.
* **AllowedGroups**: этот параметр указывает группу пользователей, которые смогут получать доступ к результатам поиска. В следующем примере группа sales-team@contoso.com иметь доступ только к записи с orderId = 12.
* **DeniedUsers**: этот параметр указывает список **пользователей,** у которых нет доступа к результатам поиска. В следующем примере пользователи, john@contoso.com и keith@contoso.com не имеют доступа к записи с orderId = 13, тогда как все остальные имеют доступ к этой записи.
* **DeniedGroups**: этот параметр указывает группу **пользователей,** у которых нет доступа к результатам поиска. В следующем примере группы engg-team@contoso.com и pm-team@contoso.com не имеют доступа к записи с orderId = 15, тогда как все остальные имеют доступ к этой записи.  

![Демонстрация данных с примерами свойств OrderTable и AclTable](media/MSSQL-ACL1.png)

### <a name="supported-data-types"></a>Поддерживаемые типы данных

В приведенной ниже таблице приведены типы данных, поддерживаемые соединитетелем Oracle SQL Oracle. В таблице также приводится итог типа данных индексации для поддерживаемого SQL данных. Дополнительные сведения о соединитах Microsoft Graph, поддерживаемых типами данных для индексирования, можно найти в документации по [типам ресурсов свойств.](https://docs.microsoft.com/graph/api/resources/property?view=graph-rest-beta#properties&preserve-view=true)

| Category | Тип исходных данных | Тип данных индексации |
| ------------ | ------------ | ------------ |
| Number datatype | NUMBER(p,0) | int64 (для p <= 18) <br> double (для p > 18) |
| Тип данных числа с плавающей за точкой | NUMBER(p,s) <br> FLOAT(p) | double |
| Тип данных Date | DATE <br> TIMESTAMP <br> TIMESTAMP(n) | datetime |
| Тип данных символа | CHAR(n) <br> VARCHAR <br> VARCHAR2 <br> LONG <br> CLOB <br> NCLOB | string |
| Тип данных символа Юникод | NCHAR <br> NVARCHAR | string |
| Тип данных RowID | ROWID <br> UROWID | string |

Для любого другого типа данных, который в настоящее время не поддерживается напрямую, столбец необходимо явно привести к поддерживаемый тип данных.

### <a name="watermark-required"></a>Водяной знак (обязательно)

Чтобы предотвратить перегрузку базы данных, соединители пакетно и возобновляют запросы полного обхода с помощью столбца подстановки для полного обхода. Используя значение столбца водяного знака, получается каждый последующий пакет, и запросы возобновляются с последней контрольной точки. По сути, это механизм управления обновлением данных при полном обходе контента.

Создайте фрагменты запроса для водяных знаков, как показано в этих примерах:

* `WHERE (CreatedDateTime > @watermark)`. Уберем имя столбца водяного знака с зарезервированным ключевым `@watermark` словом. Столбец водяного знака можно сортировать только в порядке возрастания.
* `ORDER BY CreatedDateTime ASC`. Сортировка по столбу водяного знака в порядке возрастания.

В конфигурации, показанной на следующем изображении, `CreatedDateTime` выбран столбец водяного знака. Чтобы получить первый пакет строк, укажите тип данных столбца водяного знака. В этом случае типом данных является `DateTime` .

![Конфигурация столбцов водяного знака](media/MSSQL-watermark.png)

Первый запрос получает первое **N** число строк с помощью: "CreatedDateTime > January 1, 1753 00:00:00" (min value of DateTime data type). После получения первого пакета максимальное значение, возвращаемого в пакете, будет сохранено в качестве контрольной точки, если строки сортироваться в порядке `CreatedDateTime` возрастания. Пример: 1 марта 2019 г. 03:00:00. Затем следующий пакет строк **N** получается с помощью "CreatedDateTime > March 1, 2019 03:00:00" в запросе.

### <a name="skipping-soft-deleted-rows-optional"></a>Пропуск необязательных строк (необязательно)

Чтобы исключить из индексации удаленные строки в базе данных, укажите имя и значение столбца с возможностью мягкого удаления, указывав на то, что строка удаляется.

![Параметры мягкого удаления: "Soft delete column" и "Value of soft delete column which indicates a deleted row"](media/MSSQL-softdelete.png)

### <a name="full-crawl-manage-search-permissions"></a>Полный обход контента: управление разрешениями поиска

Выберите **"Управление разрешениями",** чтобы выбрать различные столбцы управления доступом (ACL), которые определяют механизм управления доступом. Выберите имя столбца, указанное в запросе полного SQL обхода.

Каждый столбец ACL должен быть столбцом с несколькими значениями. Эти несколько значений ID могут быть разделены разделиаторами, такими как точка с запятой (;), запятая (,) и так далее. Этот сепаратор необходимо указать в **поле".**

Следующие типы ID поддерживаются для использования в качестве ALS:

* **Имя основного пользователя (UPN)**— это имя пользователя системы в формате адреса электронной почты. Имя пользователя (например, john.doe@domain.com) состоит из имени пользователя (имя для регистрации), сепаратора (символ @) и доменного имени (суффикс имени пользователя).
* **Azure Active Directory (AAD) ID:** в Azure AD каждый пользователь или группа имеет объектный ИД, похожий на "e0d3ad3d-0000-1111-2222-3c5f5c52ab9b"
* Идентификатор безопасности **Active Directory (AD):** в локальной установке AD у каждого пользователя и группы есть не изменяемый уникальный идентификатор безопасности, который выглядит как "S-1-5-21-3878594291-2115959936-132693609-65242".

![Параметры разрешений поиска для настройки списков управления доступом](media/MSSQL-ACL2.png)

## <a name="step-3b-incremental-crawl-optional"></a>Шаг 3b. Добавотельный обход контента (необязательно)

На этом необязательном шаге SQL запрос для выполнения добавного обхода базы данных. С помощью этого запроса SQL определяет все изменения данных с момента последнего добавального обхода. Как и при полном обходе контента, выберите **параметры "Запрос",** **"Поиск"** или **"Получить".** Укажите тот же набор столбцов ACL, который был указан в запросе полного обхода контента.

Компоненты на следующем изображении похожи на компоненты полного обхода за одним исключением. В этом случае выбранным столбцом водяного знака является "ModifiedDateTime". Просмотрите [действия по полному](#step-3a-full-crawl-required) обходу, чтобы узнать, как написать запрос добавного обхода контента, и посмотрите следующее изображение в качестве примера.

![Сценарий добавного обхода контента с свойствами OrderTable, AclTable и примерами, которые можно использовать.](media/MSSQL-incrcrawl.png)

## <a name="step-4-assign-property-labels"></a>Шаг 4. Назначение меток свойств

Следуйте общим [инструкциям по настройке.](https://docs.microsoft.com/microsoftsearch/configure-connector)
<!---If the above phrase does not apply, delete it and insert specific details for your data source that are different from general setup instructions.-->

## <a name="step-5-manage-schema"></a>Шаг 5. Управление схемой

Следуйте общим [инструкциям по настройке.](https://docs.microsoft.com/microsoftsearch/configure-connector)
<!---If the above phrase does not apply, delete it and insert specific details for your data source that are different from general setup instructions.-->

## <a name="step-6-manage-search-permissions"></a>Шаг 6. Управление разрешениями поиска

Вы можете использовать [ALS,](#full-crawl-manage-search-permissions) указанные на экране полного обхода контента, или переопредить их, чтобы сделать контент видимым для всех.

## <a name="step-7-choose-refresh-settings"></a>Шаг 7. Выбор параметров обновления

Соединитель Oracle SQL поддерживает расписания обновления как для полных, так и для добавкальных обходов контента. Рекомендуется установить и то, и другое.

Полное расписание обхода находит удаленные строки, которые ранее синхронизировались с индексом Поиска (Майкрософт) и все строки, которые были удалены из фильтра синхронизации. При первом подключении к базе данных выполняется полный обход, чтобы синхронизировать все строки, полученные из полного запроса обхода. Чтобы синхронизировать новые строки и делать обновления, необходимо запланировать добавонные обходы контента.

## <a name="step-8-review-connection"></a>Шаг 8. Проверка подключения

Следуйте общим [инструкциям по настройке.](https://docs.microsoft.com/microsoftsearch/configure-connector)
<!---If the above phrase does not apply, delete it and insert specific details for your data source that are different from general setup instructions.-->

## <a name="next-steps-customize-the-search-results-page"></a>Дальнейшие действия: настройка страницы результатов поиска

Создайте собственные вертикали и типы результатов, чтобы конечные пользователи могли просматривать результаты поиска из новых подключений. Без этого шага данные из подключения не будут показываться на странице результатов поиска.

Дополнительные узнать о создании вертикали и MRTs см. в настройках страницы [результатов поиска.](customize-search-page.md)

## <a name="troubleshooting"></a>Устранение неполадок

Ниже находится список распространенных ошибок, которые наблюдаются при настройке соединители, и их возможных причин.

| Этап настройки | Сообщение об ошибке | Возможные причины |
| ------------ | ------------ | ------------ |
| Параметры базы данных | Ошибка с сервера базы данных: время и время запроса на подключение не было | Недопустимое имя хоста <br> Host not reachable |
| Параметры базы данных | Ошибка сервера базы данных: ORA-12541: TNS: нет прослушиватель | Недопустимый порт |
| Параметры базы данных | Ошибка с сервера базы данных: ORA-12514: TNS: прослушиватель в настоящее время не знает о службе, запрашиваемой в дескрипторе соединителя | Недопустимое имя службы (базы данных) |
| Параметры базы данных | Ошибка сервера базы данных: ошибка входа для пользователя `user` '. | Недопустимое имя пользователя или пароль |

## <a name="limitations"></a>Ограничения

Соедините SQL Oracle имеет указанные в предварительной версии ограничения:

* В локальной базе данных должна работать база данных Oracle версии 11g или более поздней.
* ALS поддерживаются только с помощью имени основного пользователя (UPN), Azure Active Directory (Azure AD) или active Directory Security.
* Индексация содержимого в столбцах базы данных не поддерживается. Примерами такого контента являются HTML, JSON, XML, BLOB-элементы и синтаксики документов, которые существуют в качестве ссылок в столбцах базы данных.
